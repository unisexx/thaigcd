<?php
class Profile extends Admin_Controller
{
	
	function __construct()
	{
		parent::__construct();
		$this->load->model('profile_model','profile');
	}
	
	function index()
	{
		$data['rs'] = $this->profile->get_row('user_id',$this->session->userdata('id'));
		$this->template->build('admin/user_profile',$data);
	}
	
	function save()
	{
		if($_POST)
		{
			$_POST['id'] = $this->profile->get_one('id','user_id',$this->session->userdata('id'));
			$_POST['user_id'] = $this->session->userdata('id');
			$_POST['modified'] = time();
			$id = $this->profile->save($_POST);
			if($_FILES['image']['name'])
			{
				$this->profile->delete_file($id,'uploads/user/','image');
				$this->profile->delete_file($id,'uploads/user/thumb/','image');
				$this->profile->delete_file($id,'uploads/user/50x50/','image');
				$this->profile->save(array('id' => $id, 'avatar' => $this->profile->upload($_FILES['image'],'uploads/user/')));
				$this->profile->thumb('uploads/user/thumb/',100,100);
				$this->profile->thumb('uploads/user/50x50/',50,50);
			} 
			set_notify('success', SAVE_DATA_COMPLETE);
		}
		redirect('user/admin/profile');
	}
	
	function remove_image()
	{
		$id = $this->profile->get_one('id','user_id',$this->session->userdata('id'));
		$this->profile->delete_file($id,'uploads/user/','avatar');
		$this->profile->delete_file($id,'uploads/user/thumb/','avatar');
		$this->profile->delete_file($id,'uploads/user/50x50/','avatar');
		$this->profile->save(array('id' => $id, 'avatar' => NULL));
		set_caution('success', REMOVE_IMAGE_COMPLETE,'.avatar');
		redirect('user/admin/profile');	
	}

}
?>