<?php 

if(!function_exists('set_notify'))
{
	function set_notify($type,$msg)
	{
		$config = array(
			'notify' => TRUE,
			'type' => $type,
			'msg' => $msg
		);
		$CI =& get_instance();
		$CI->session->set_flashdata($config);
	}
}

if(!function_exists('get_one'))
{
	function get_one($field,$table,$id='id',$value)
	{
		$CI =& get_instance();
		$result = $CI->db->getone('select '.$field.' from '.$table.' where '.$id.' = ?',$value);
		return $result;
	}
}

if(!function_exists('notify'))
{
	function js_notify()
	{
		$CI =& get_instance();
		if($CI->session->flashdata('notify'))
		{
			$js = '<link rel="stylesheet" href="js/notifyBar/jquery.notifyBar.css" type="text/css" media="screen" />';
		    $js .= '<script type="text/javascript" src="js/notifyBar/jquery.notifyBar.js"></script>';
		    $js .= '<script type="text/javascript">
		    				$(function () {
						  		$.notifyBar({
						  			cls:"'.$CI->session->flashdata('type').'",
						    		html: "'.$CI->session->flashdata('msg').'",
						    		delay: 2000,
						    		animationSpeed: "normal"
						  		});  
							});
						</script>';
			return $js; 
		}
	}
}
//$type -> attention information success error
if(!function_exists('set_caution'))
{
	function set_caution($type,$msg,$selector=".block_content",$close=FALSE,$position="prepend")
	{
		$config = array(
			'caution' => TRUE,
			'type' => $type,
			'msg' => $msg,
			'position' => $position,
			'close' => $close,
			'selector' => $selector
		);
		$CI =& get_instance();
		$CI->session->set_flashdata($config);
	}
}

if(!function_exists('js_caution'))
{
	function js_caution()
	{
		$CI =& get_instance();
		if($CI->session->flashdata('caution'))
		{
			$close = ($CI->session->flashdata('close'))?"<a class='close' href='#'><img alt='close' title='Close this notification' src='js/caution/images/cross_grey_small.png'></a>":'';
			$js_close = ($CI->session->flashdata('close'))?'$(".caution a.close").click(function(){$(this).parent().remove(); return false;});':'';
		    $html = "<div class='caution ".$CI->session->flashdata('type')." png_bg'>".$close."<div>".$CI->session->flashdata('msg')."</div></div>";
			$js = '<link rel="stylesheet" href="js/caution/jquery.cautionBar.css" type="text/css" media="screen" />';
			$js .= '<script type="text/javascript">
		    				$(function () {
						  		$("'.$CI->session->flashdata('selector').'").'.$CI->session->flashdata('position').'("'.$html.'");
								'.$js_close.' 
							});
					</script>';
			return $js; 
		}
	}
}

if(!function_exists('menu_active'))
{
	function menu_active($module,$controller = FALSE,$class='active')
	{
		$CI =& get_instance();
		if($controller)
		{
			return ($CI->router->fetch_module() == $module && $CI->router->fetch_class() == $controller) ? 'class='.$class : '';	
		}
		else
		{
			return ($CI->router->fetch_module() == $module) ? 'class='.$class : '';	
		}
	}
}

function cycle($key,$odd = 'odd',$even = '')
{
	return ($key&1) ? 'class="'.$even.'"' : 'class="'.$odd.'"';
}

function get_option($value,$text,$table)
{
	$CI =& get_instance();
	return $CI->db->GetAssoc('select '.$value.','.$text.' from '.$table);
}

function getIP(){
    $ip = (getenv(HTTP_X_FORWARDED_FOR))
    ?  getenv(HTTP_X_FORWARDED_FOR)
    :  getenv(REMOTE_ADDR);
    return $ip;
}

function currency_rate($price)
{
	$CI =& get_instance();
	$CI->load->model('currency/currency_model');
	$currency = $CI->currency_model->get_active_rate($CI->session->userdata('currency'));
	return number_format(($price * $currency['rate']),2).' '.$currency['currency'];
}

function js_visualize()
{
	return '<link rel="stylesheet" href="js/visualize.css" type="text/css" media="screen" />
			<script type="text/javascript" src="js/jquery.visualize.js"></script>
			<script type="text/javascript">
			$(function(){
			$("table.stats").hide().visualize({
				type: "line", // "bar", "area", "pie", "line"
				width: "880px",
				height: "240px",
				colors: ["#6fb9e8", "#ec8526", "#9dc453", "#ddd74c"]
				}); 
			});
			</script>
			';
}


function js_checkbox()
{
	$CI =& get_instance();
	return '<link rel="stylesheet" href="js/checkbox/jquery.checkbox.css" />
		<script type="text/javascript" src="js/checkbox/jquery.checkbox.min.js"></script>
		<script>
			$(function(){
				$("input:checkbox").checkbox({empty:"js/checkbox/empty.png"});
				$("input:checkbox").click(function(){
					var value = this.checked ? 0 : 1;
					$.post("'.$CI->router->fetch_module().'/admin/'.$CI->router->fetch_module().'/save",{id:this.value ,active:value}); 
				});
			});
		</script>';
}

function display_crumb($data,$link=FALSE)
{
	$crumb = "";
	$delimiter = "";
	foreach($data as $key => $item)
	{
		$crumb .= ($link)?$delimiter.anchor($link.$item['id'],$item['name']):$delimiter.$item['name'];
		$delimiter=" » ";
	}
	return $crumb;
}

function breadcrumb($data)
{
	$breadcrumb = '<ul class="corner" id="crumbs"><li style="list-style-type: none; padding: 0px 0px 0px 5px; margin: 0pt; display: inline;"><a href="">หน้าแรก</a></li>';
	foreach($data as $key => $value)
	{
		$breadcrumb .= '<span>»</span>';
		$breadcrumb .= '<li style="list-style-type: none; padding: 0px 0px 0px 5px; margin: 0pt; display: inline;">'.anchor($key,$value).'</li>';
	}
	$breadcrumb .= '</ul>';
	return $breadcrumb;
}

function split_lang($content)
{
	return array_combine (preg_split('/(\].+\[\/)|\[|\]/i', $content,-1,PREG_SPLIT_NO_EMPTY ),preg_split('/\[[^\]]*[^\/]\]/i', $content,-1,PREG_SPLIT_NO_EMPTY ));
}

function get_lang($content = FALSE,$lang = 'th')
{
	//return preg_split("/\[$lang\](.+?)\[\/$lang\]/i", $content,-1,PREG_SPLIT_NO_EMPTY );
	//return preg_replace("/\[$lang\](.+?)\[\/$lang\]/i", '$1', $content);
	if($content)
	{
		$content = str_replace("\n", "<br />", $content);
		preg_match("/\[$lang\](?P<$lang>.+?)\[\/$lang\]/i", $content, $data);
		@$data[$lang] = str_replace("<br />", "\n", @$data[$lang]);
		return @$data[$lang];
	}
}
function merge_lang($content = FALSE)
{
	if($content)
	{
		foreach($content as $key => $value)
		{
			$data .= '['.$key.']'.$value.'[/'.$key.']';
		}
		return $data;
	}
}





?>