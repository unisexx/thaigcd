<?php
class categories extends Admin_Controller
{
	function __construct()
	{
		parent::__construct();
		$this->template->set_layout('lightbox');
		$this->load->model('category_model','category');
	}
	
	function index($module = 'article')
	{
		
		$this->category->module($module);
		$data['module'] = $module;
		$data['result'] = $this->category->get();
		$data['pagination'] = $this->category->pagination();
		$this->template->build('admin/category_index',$data);
	}
	
	function form($module,$id=FALSE)
	{
			$data['module'] = $module;
			$data['rs'] = $this->category->get_row($id);
			$this->template->build('admin/category_form',$data);
	}
	
	function save()
	{
		if(@$_POST['slug']=="")
		{
			$_POST['slug'] = clean_url($_POST['name']);
		}
		$this->category->save($_POST);
		set_notify('success', lang('save_data_complete'));
		redirect('category/admin/category/'.$module);
	}
	
	function delete($id)
	{
		$result = $this->article->where('cat_id = '.$id)->get();
		foreach($result as $rs)
		{
			$this->article->delete_file($rs['id'],'uploads/article/','image');
			$this->article->delete_file($rs['id'],'uploads/article/thumb/','image');
		}
		$this->article->delete('cat_id',$id);
		$this->category->delete($id);
		set_notify('success', DELETE_DATA_COMPLETE);
		redirect('category/admin/category');
	}
	
	function inc_menu($where = 'parent = 0',$view = 'admin/inc_menu')
	{
		$data['result'] = $this->category->where($where)->get();
		$this->load->view($view,$data);
	}
}
?>